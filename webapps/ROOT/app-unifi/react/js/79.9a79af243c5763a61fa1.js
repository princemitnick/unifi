(window.webpackJsonpunifiNetworkUi=window.webpackJsonpunifiNetworkUi||[]).push([[79],{1815:function(e,l,t){"use strict";t.r(l);var E,a,_=t(0),r=t.n(_),n=t(4),T=t(8),c=t(31),R=t(170),o=t(392),i=t(268),N=t(28),A=t(13),u=t(97),s=t(1945),L=t(464),S=t(21),m=t(64),p=t(18),d=t(98),I=t(30),O=t(2158);!function(e){e.AFTER="AFTER",e.BEFORE="BEFORE"}(E||(E={})),function(e){e.ADDRESS_PORT_GROUP="addressPortGroup",e.IP_ADDRESS="ipAddress",e.NETWORK="network"}(a||(a={}));const F=(e,l,t)=>[{label:t.formatMessage({id:"COMMON_ANY"}),value:""},...e.filter(({group_type:e})=>e===l).map(({_id:e,name:l,group_members:t})=>({label:l,value:e,members:t}))],G=(e,l)=>{const t=e["src"===l?"src_address":"dst_address"],E=e["src"===l?"src_firewallgroup_ids":"dst_firewallgroup_ids"],_=e["src"===l?"src_networkconf_id":"dst_networkconf_id"],r=e["src"===l?"src_networkconf_type":"dst_networkconf_type"];return(null==E?void 0:E.length)>0?a.ADDRESS_PORT_GROUP:t?a.IP_ADDRESS:_||r&&r!==i.FirewallRuleNetworkconfType.NETV4?a.NETWORK:a.ADDRESS_PORT_GROUP},M=e=>Object.values(i.FirewallRuleRulesetV6).includes(e.ruleset),w=(e,l,t)=>{const a={ruleset:i.FirewallRuleRulesetV4.WAN_IN,protocol:"all",protocol_v6:"all",...t},_=M(a)?a.protocol_v6:a.protocol,r=Number.isNaN(Number(_))?{firewallRuleProtocolNumber:0}:{firewallRuleProtocolNumber:Number(_),[M(a)?"protocol_v6":"protocol"]:"number"},n=((e,l,t)=>["dst","src"].reduce((E,a)=>{var _,r;const n=e["src"===a?"src_firewallgroup_ids":"dst_firewallgroup_ids"],T=e["src"===a?"src_networkconf_id":"dst_networkconf_id"];return{...E,["src"===a?"src_networkconf_id":"dst_networkconf_id"]:(null===(_=l.find(({_id:e})=>e===T))||void 0===_?void 0:_._id)||(null===(r=l[0])||void 0===r?void 0:r._id)||"",["src"===a?"firewallRuleSrcIpV4AddressGroup":"firewallRuleDstIpV4AddressGroup"]:n.find(e=>t.some(({_id:l,group_type:t})=>l===e&&t===o.FirewallGroupType.ADDRESS_GROUP))||"",["src"===a?"firewallRuleSrcIpV6AddressGroup":"firewallRuleDstIpV6AddressGroup"]:n.find(e=>t.some(({_id:l,group_type:t})=>l===e&&t===o.FirewallGroupType.IPV6_ADDRESS_GROUP))||"",["src"===a?"firewallRuleSrcPortGroup":"firewallRuleDstPortGroup"]:n.find(e=>t.some(({_id:l,group_type:t})=>l===e&&t===o.FirewallGroupType.PORT_GROUP))||"",["src"===a?"firewallRuleSrcType":"firewallRuleDstType"]:G(e,a)}},{}))({dst_firewallgroup_ids:[],dst_networkconf_id:"",src_firewallgroup_ids:[],src_networkconf_id:"",...t},e,l);return{action:i.FirewallRuleAction.ACCEPT,enabled:!0,firewallRuleApplied:Object(i.getRulePriority)({rule_index:2e3,...t})===i.FirewallRulePriority.HIGH?E.BEFORE:E.AFTER,dst_address:"",dst_firewallgroup_ids:[],dst_networkconf_type:i.FirewallRuleNetworkconfType.NETV4,icmp_typename:"",icmpv6_typename:"",ipsec:i.FirewallRuleIpsec.DONT_MATCH,logging:!1,name:"",protocol:"all",protocol_match_excepted:!1,protocol_v6:"all",ruleset:i.FirewallRuleRulesetV4.WAN_IN,src_firewallgroup_ids:[],src_address:"",src_mac_address:"",src_networkconf_type:i.FirewallRuleNetworkconfType.NETV4,state_established:!1,state_invalid:!1,state_new:!1,state_related:!1,...t,...r,...n}},D=[i.FirewallRuleAction.ACCEPT,i.FirewallRuleAction.REJECT,i.FirewallRuleAction.DROP].map(e=>({label:Object(O.c)(e),value:e})),b=[{label:"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_FORM_VALUE_FIREWALL_RULE_APPLIED_BEFORE",value:E.BEFORE},{label:"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_FORM_VALUE_FIREWALL_RULE_APPLIED_AFTER",value:E.AFTER}],U=i.FIREWALL_RULE_ICMP_TYPENAMES.map(e=>({label:Object(O.d)(e),value:e})),f=i.FIREWALL_RULE_ICMPV6_TYPENAMES.map(e=>({label:Object(O.d)(e),value:e})),P=[{label:"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_IPSEC_DONT_MATCH",value:i.FirewallRuleIpsec.DONT_MATCH},{label:"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_IPSEC_MATCH_IPSEC",value:i.FirewallRuleIpsec.MATCH_IPSEC},{label:"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_IPSEC_MATCH_NON_IPSEC",value:i.FirewallRuleIpsec.MATCH_NON_IPSEC}],C=[...i.FIREWALL_RULE_PROTOCOLS,"number"].map(e=>({label:Object(O.e)(e),value:e})),W=[...i.FIREWALL_RULE_PROTOCOLS_V6,"number"].map(e=>({label:Object(O.e)(e),value:e})),g=[{label:"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_NETWORKCONF_TYPE_NETV4",value:i.FirewallRuleNetworkconfType.NETV4},{label:"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_NETWORKCONF_TYPE_ADDRV4",value:i.FirewallRuleNetworkconfType.ADDRV4}],h=[{label:"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_FORM_SRC_DST_TYPE_ADDRESS_PORT_GROUP",value:a.ADDRESS_PORT_GROUP},{label:"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_FORM_SRC_DST_TYPE_NETWORK",value:a.NETWORK},{label:"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_FORM_SRC_DST_TYPE_IP_ADDRESS",value:a.IP_ADDRESS}],V=[i.FirewallRuleRulesetV4.WAN_IN,i.FirewallRuleRulesetV4.WAN_OUT,i.FirewallRuleRulesetV4.WAN_LOCAL,i.FirewallRuleRulesetV4.LAN_IN,i.FirewallRuleRulesetV4.LAN_OUT,i.FirewallRuleRulesetV4.LAN_LOCAL,i.FirewallRuleRulesetV4.GUEST_IN,i.FirewallRuleRulesetV4.GUEST_OUT,i.FirewallRuleRulesetV4.GUEST_LOCAL,i.FirewallRuleRulesetV6.WANV6_IN,i.FirewallRuleRulesetV6.WANV6_OUT,i.FirewallRuleRulesetV6.WANV6_LOCAL,i.FirewallRuleRulesetV6.LANV6_IN,i.FirewallRuleRulesetV6.LANV6_OUT,i.FirewallRuleRulesetV6.LANV6_LOCAL,i.FirewallRuleRulesetV6.GUESTV6_IN,i.FirewallRuleRulesetV6.GUESTV6_OUT,i.FirewallRuleRulesetV6.GUESTV6_LOCAL].map(e=>({label:Object(O.f)(e),value:e})),y=I.a.object().shape({dst_address:I.a.string().when(["firewallRuleDstType","ruleset"],{is:(e,l)=>e===a.IP_ADDRESS&&!M({ruleset:l}),then:I.b}),dst_port:I.a.string().when(["firewallRuleDstType","protocol","ruleset"],{is:(e,l,t)=>e===a.IP_ADDRESS&&["tcp","tcp_udp","udp"].includes(l)&&!M({ruleset:t}),then:I.a.string().unifiPortRange(r.a.createElement(n.c,{id:"COMMON_VALIDATION_VALID_PORT_RANGE"}))}),firewallRuleDstType:I.a.string().oneOf(Object.values(a)),firewallRuleProtocolNumber:I.a.number().when(["protocol","protocol_v6","ruleset"],{is:(e,l,t)=>M({ruleset:t})?"number"===l:"number"===e,then:I.a.number().label("SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_FORM_FIELD_FIREWALL_RULE_PROTOCOL_NUMBER_LABEL").required().min(0).max(255)}),name:I.a.string().label("SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_FORM_FIELD_NAME_LABEL").required(),firewallRuleSrcType:I.a.string().oneOf(Object.values(a)),protocol:I.a.string().oneOf(i.FIREWALL_RULE_PROTOCOLS),protocol_v6:I.a.string().oneOf(i.FIREWALL_RULE_PROTOCOLS_V6),ruleset:I.a.string().oneOf([...Object.values(i.FirewallRuleRulesetV4),...Object.values(i.FirewallRuleRulesetV6)]),src_address:I.a.string().when(["firewallRuleSrcType","ruleset"],{is:(e,l)=>e===a.IP_ADDRESS&&!M({ruleset:l}),then:I.b}),src_mac_address:I.a.string().matches(d.p,r.a.createElement(n.c,{id:"COMMON_VALIDATION_VALID_MAC"})),src_port:I.a.string().when(["firewallRuleSrcType","protocol","ruleset"],{is:(e,l,t)=>e===a.IP_ADDRESS&&["tcp","tcp_udp","udp"].includes(l)&&!M({ruleset:t}),then:I.a.string().unifiPortRange(r.a.createElement(n.c,{id:"COMMON_VALIDATION_VALID_PORT_RANGE"}))})});var v=t(1917),H=t(6),k=t(2),j=t(45),x=t(1753),B=t(1754),Y=t(1924),K=t(1755),$=t(1954),J=t(54);var z=()=>{const{setFieldValue:e,values:l}=Object(j.e)(),t=Object(_.useRef)(!0),E=M(l)?"all"===l.protocol_v6:"all"===l.protocol,a=M(l)?"icmpv6"===l.protocol_v6:"icmp"===l.protocol,T=M(l)?"number"===l.protocol_v6:"number"===l.protocol;return Object(_.useEffect)(()=>{if(!t.current)if(M(l)){const t=l.protocol,E=W.findIndex(({value:e})=>e===t);e("protocol_v6",W[-1!==E?E:0].value)}else{const t=l.protocol_v6,E=C.findIndex(({value:e})=>e===t);e("protocol",C[-1!==E?E:0].value)}t.current=!1},[l.ruleset]),r.a.createElement(x.a,null,r.a.createElement(B.a,null,r.a.createElement(Y.a,{alignWith:"dropdown",htmlFor:"ruleset",label:r.a.createElement(n.c,{id:"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_FORM_FIELD_RULESET_LABEL"})}),r.a.createElement(K.a,{column:!0},r.a.createElement(J.Field,{full:!0,name:"ruleset",options:V,searchable:!0,translateOptions:!0,type:"dropdown"}))),r.a.createElement(B.a,null,r.a.createElement(Y.a,{alignWith:"input",htmlFor:"name",label:r.a.createElement(n.c,{id:"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_FORM_FIELD_NAME_LABEL"})}),r.a.createElement(K.a,{column:!0},r.a.createElement(J.Field,{full:!0,name:"name",placeholder:"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_FORM_FIELD_NAME_PLACEHOLDER"}))),r.a.createElement(B.a,null,r.a.createElement(Y.a,{alignWith:"toggleSmall",htmlFor:"enabled",label:r.a.createElement(n.c,{id:"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_FORM_FIELD_ENABLED_LABEL"})}),r.a.createElement(K.a,{column:!0},r.a.createElement(J.Field,{name:"enabled",type:"checkbox"}))),r.a.createElement(B.a,null,r.a.createElement(Y.a,{alignWith:"dropdown",htmlFor:"firewallRuleApplied",label:r.a.createElement(n.c,{id:"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_FORM_FIELD_FIREWALL_RULE_APPLIED_LABEL"})}),r.a.createElement(K.a,{column:!0},r.a.createElement(J.Field,{full:!0,name:"firewallRuleApplied",options:b,translateOptions:!0,type:"dropdown"}))),r.a.createElement(B.a,null,r.a.createElement(Y.a,{alignWith:"dropdown",htmlFor:"action",label:r.a.createElement(n.c,{id:"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_FORM_FIELD_ACTION_LABEL"})}),r.a.createElement(K.a,{column:!0},r.a.createElement(J.Field,{full:!0,name:"action",options:D,translateOptions:!0,type:"dropdown"}))),r.a.createElement(B.a,null,r.a.createElement(Y.a,{alignWith:"dropdown",htmlFor:M(l)?"protocol_v6":"protocol",label:r.a.createElement(n.c,{id:M(l)?"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_FORM_FIELD_PROTOCOL_V6_LABEL":"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_FORM_FIELD_PROTOCOL_LABEL"})}),r.a.createElement(K.a,{column:!0},r.a.createElement(J.Field,{full:!0,name:M(l)?"protocol_v6":"protocol",options:M(l)?W:C,searchable:!0,translateOptions:!0,type:"dropdown"}))),r.a.createElement($.a,{in:a&&!l.protocol_match_excepted},r.a.createElement(B.a,null,r.a.createElement(Y.a,{alignWith:"dropdown",htmlFor:M(l)?"icmpv6_typename":"icmp_typename",label:r.a.createElement(n.c,{id:M(l)?"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_FORM_FIELD_ICMPV6_TYPENAME_LABEL":"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_FORM_FIELD_ICMP_TYPENAME_LABEL"})}),r.a.createElement(K.a,{column:!0},r.a.createElement(J.Field,{full:!0,name:M(l)?"icmpv6_typename":"icmp_typename",options:M(l)?f:U,searchable:!0,translateOptions:!0,type:"dropdown"})))),r.a.createElement($.a,{in:T},r.a.createElement(B.a,null,r.a.createElement(Y.a,{alignWith:"input",htmlFor:"firewallRuleProtocolNumber",label:r.a.createElement(n.c,{id:"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_FORM_FIELD_FIREWALL_RULE_PROTOCOL_NUMBER_LABEL"})}),r.a.createElement(K.a,{column:!0},r.a.createElement(J.Field,{full:!0,name:"firewallRuleProtocolNumber",placeholder:"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_FORM_FIELD_FIREWALL_RULE_PROTOCOL_NUMBER_PLACEHOLDER",type:"number"})))),r.a.createElement($.a,{in:!E},r.a.createElement(B.a,null,r.a.createElement(Y.a,{alignWith:"toggleSmall",htmlFor:"protocol_match_excepted",label:r.a.createElement(n.c,{id:"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_FORM_FIELD_PROTOCOL_MATCH_EXCEPTED_LABEL"})}),r.a.createElement(K.a,{column:!0},r.a.createElement(J.Field,{name:"protocol_match_excepted",type:"checkbox"})))))},X=t(5),q=t(254),Q=t(1759),Z=t(538),ee=t(2291),le=t(2208);const te=Object(X.c)(Q.a)`
  width: 378px !important;
`,Ee=Object(X.c)("div")`
  padding: ${({theme:e})=>e.spacing["spacing-s"]} 0;
`;var ae=({hideModal:e,handleGroupField:l,type:t,initialValues:E={}})=>{const a=Object(T.useDispatch)(),c=Object(T.useSelector)(A.u),R=Object(_.useCallback)((t,{setSubmitting:E})=>a(Object(o.saveFirewallGroup)({...t,group_members:(t.group_members||[]).filter(e=>!!e)})).then(e=>{l(e),a(Object(S.c)({icon:p.a.success,message:"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_GROUPS_FORM_TOAST_SAVE_SUCCESS",values:{name:t.name}}))}).then(e).catch(e=>{a(Object(S.c)({errorMessage:e.msg,errorValues:e,icon:p.a.danger,message:"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_GROUPS_FORM_TOAST_SAVE_FAILURE",values:{name:t.name}})),E(!1)}),[a,e,l]);return r.a.createElement(j.c,{onSubmit:R,initialValues:{name:"",group_type:t,group_members:[],...E},validationSchema:le.b},({handleSubmit:l,isSubmitting:t})=>r.a.createElement(te,{parentSelector:Z.b,isOpen:!0,title:r.a.createElement(n.c,{id:"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_GROUPS_FORM_TITLE_NEW"}),actions:[{text:r.a.createElement(n.c,{id:"COMMON_ACTION_CANCEL"}),type:"button",style:{width:123},onClick:e},{text:r.a.createElement(n.c,{id:"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_GROUPS_BUTTON_CREATE"}),type:"submit",variant:"primary",style:{width:175},disabled:c||t,loader:t?"spinner":null,onClick:()=>l()}]},r.a.createElement(Ee,null,r.a.createElement(ee.a,{modalForm:!0}))))};const _e=Object(X.c)("li",{shouldForwardProp:e=>"isNewGroupItem"!==e})`
  ${({theme:e,isNewGroupItem:l})=>l&&`\n    color: ${e.motifPalette.link01};\n    :hover {\n      color: ${e.motifPalette.hoverLink01};\n    }\n  `}
`,re=(e,l)=>{const t=parseInt(l,10);return!(l!==t.toString()||!Number.isFinite(t))&&(2===e.length&&t>=parseInt(e[0],10)&&t<=parseInt(e[1],10))};function ne({id:e,onClick:l,isSelected:t,className:E,children:a,option:_}){const T=q.a===_.value;return r.a.createElement(_e,{id:e,onClick:l,className:E,"aria-selected":t,role:"option",isNewGroupItem:T},T?r.a.createElement(n.c,{id:"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_GROUPS_BUTTON_CREATE"}):a)}var Te=({name:e,options:l,type:t})=>{const{setFieldValue:E}=Object(j.e)(),[a,n]=Object(_.useState)(!1),[T,c]=Object(_.useState)(""),R=Object(_.useCallback)((l,t)=>{q.a===t?n(!0):E(e,t)},[e,E]),i=Object(_.useCallback)((e,l)=>e.filter(({label:e,members:E=[]})=>e.toString().toLowerCase().includes(l.toLowerCase())||((e,l,t)=>e.some(e=>{if(e===l)return!0;switch(t){case o.FirewallGroupType.PORT_GROUP:return re(e.split("-"),l);case o.FirewallGroupType.ADDRESS_GROUP:return re(e.split("-").map(e=>e.replace(/\./g,"")),l.replace(/\./g,""));default:return!1}}))(E,l,t)),[t]),N=Object(_.useMemo)(()=>{let e=[d.r];return t===o.FirewallGroupType.ADDRESS_GROUP&&(e=[d.h,d.j]),t===o.FirewallGroupType.IPV6_ADDRESS_GROUP&&(e=[d.k,d.m]),e.some(e=>T.match(e))?{group_members:[T]}:{name:T}},[T,t]);return r.a.createElement(r.a.Fragment,null,r.a.createElement(J.Field,{name:e,options:l,renderOption:ne,onChange:R,inputProps:{onBlur:e=>c(e.target.value)},customSearchFilter:i,type:"dropdown",searchable:!0,creatable:!0,full:!0}),a&&r.a.createElement(ae,{hideModal:()=>n(!1),handleGroupField:({_id:l,group_type:a})=>{a===t&&E(e,l)},type:t,initialValues:N}))};var ce=Object(n.f)(({intl:e,src:l})=>{const t=l?"src_address":"dst_address",E=l?"firewallRuleSrcIpV4AddressGroup":"firewallRuleDstIpV4AddressGroup",c=l?"firewallRuleSrcIpV6AddressGroup":"firewallRuleDstIpV6AddressGroup",R=l?"src_networkconf_id":"dst_networkconf_id",i=l?"src_networkconf_type":"dst_networkconf_type",A=l?"firewallRuleSrcPortGroup":"firewallRuleDstPortGroup",u=l?"src_port":"dst_port",s=l?"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_FORM_SRC_DST_FIELD_FIREWALL_RULE_SRC_TYPE_LABEL":"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_FORM_SRC_DST_FIELD_FIREWALL_RULE_DST_TYPE_LABEL",L=l?"firewallRuleSrcType":"firewallRuleDstType",{errors:S,values:m}=Object(j.e)(),p=Object(T.useSelector)(N.selectCorporateAndGuestNetworks),d=Object(T.useSelector)(o.selectFirewallGroups),I=Object(_.useMemo)(()=>F(d,o.FirewallGroupType.ADDRESS_GROUP,e),[d,e]),O=Object(_.useMemo)(()=>F(d,o.FirewallGroupType.IPV6_ADDRESS_GROUP,e),[d,e]),G=Object(_.useMemo)(()=>p.map(({_id:e,name:l})=>({label:l,value:e})),[p]),w=Object(_.useMemo)(()=>F(d,o.FirewallGroupType.PORT_GROUP,e),[d,e]);return r.a.createElement(x.a,{padding:"none"},M(m)?r.a.createElement(r.a.Fragment,null,r.a.createElement(B.a,null,r.a.createElement(Y.a,{alignWith:"dropdown",htmlFor:c,label:r.a.createElement(n.c,{id:"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_FORM_SRC_DST_FIELD_IPV6_ADDRESS_GROUP_LABEL"})}),r.a.createElement(K.a,null,r.a.createElement(Te,{name:c,options:O,type:o.FirewallGroupType.IPV6_ADDRESS_GROUP}))),r.a.createElement(B.a,null,r.a.createElement(Y.a,{alignWith:"dropdown",htmlFor:A,label:r.a.createElement(n.c,{id:"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_FORM_SRC_DST_FIELD_PORT_GROUP_LABEL"})}),r.a.createElement(K.a,null,r.a.createElement(Te,{name:A,options:w,type:o.FirewallGroupType.PORT_GROUP})))):r.a.createElement(r.a.Fragment,null,r.a.createElement(B.a,null,r.a.createElement(Y.a,{alignWith:"dropdown",htmlFor:L,label:r.a.createElement(n.c,{id:s})}),r.a.createElement(K.a,null,r.a.createElement(J.Field,{full:!0,name:L,options:h,translateOptions:!0,type:"dropdown"}))),r.a.createElement($.a,{in:m[L]===a.ADDRESS_PORT_GROUP,wrap:!0,flexDirection:"column"},m[L]===a.ADDRESS_PORT_GROUP&&r.a.createElement(r.a.Fragment,null,r.a.createElement(B.a,null,r.a.createElement(Y.a,{alignWith:"dropdown",htmlFor:E,label:r.a.createElement(n.c,{id:"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_FORM_SRC_DST_FIELD_IPV4_ADDRESS_GROUP_LABEL"})}),r.a.createElement(K.a,null,r.a.createElement(Te,{name:E,options:I,type:o.FirewallGroupType.ADDRESS_GROUP}))),r.a.createElement(B.a,null,r.a.createElement(Y.a,{alignWith:"dropdown",htmlFor:A,label:r.a.createElement(n.c,{id:"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_FORM_SRC_DST_FIELD_PORT_GROUP_LABEL"})}),r.a.createElement(K.a,null,r.a.createElement(Te,{name:A,options:w,type:o.FirewallGroupType.PORT_GROUP}))))),r.a.createElement($.a,{in:m[L]===a.NETWORK,wrap:!0,flexDirection:"column"},m[L]===a.NETWORK&&r.a.createElement(r.a.Fragment,null,r.a.createElement(B.a,null,r.a.createElement(Y.a,{alignWith:"dropdown",htmlFor:R,label:r.a.createElement(n.c,{id:"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_FORM_SRC_DST_FIELD_NETWORKCONF_ID"})}),r.a.createElement(K.a,null,r.a.createElement(J.Field,{full:!0,name:R,options:G,type:"dropdown"}))),r.a.createElement(B.a,null,r.a.createElement(Y.a,{alignWith:"dropdown",htmlFor:i,label:r.a.createElement(n.c,{id:"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_FORM_SRC_DST_FIELD_NETWORKCONF_TYPE"})}),r.a.createElement(K.a,null,r.a.createElement(J.Field,{full:!0,name:i,options:g,translateOptions:!0,type:"dropdown"}))))),r.a.createElement($.a,{in:m[L]===a.IP_ADDRESS,wrap:!0,flexDirection:"column"},m[L]===a.IP_ADDRESS&&r.a.createElement(r.a.Fragment,null,r.a.createElement(B.a,null,r.a.createElement(Y.a,{alignWith:"input",htmlFor:t,label:r.a.createElement(n.c,{id:"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_FORM_SRC_DST_FIELD_ADDRESS_LABEL"})}),r.a.createElement(K.a,{column:!0},r.a.createElement(J.Field,{full:!0,name:t,placeholder:"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_FORM_SRC_DST_FIELD_ADDRESS_PLACEHOLDER"}))),["tcp","tcp_udp","udp"].includes(m.protocol)&&r.a.createElement(B.a,null,r.a.createElement(Y.a,{alignWith:"input",htmlFor:u,label:r.a.createElement(n.c,{id:"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_FORM_SRC_DST_FIELD_PORT_LABEL"})}),r.a.createElement(K.a,{column:!0},r.a.createElement(J.Field,{full:!0,name:u,placeholder:"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_FORM_SRC_DST_FIELD_PORT_PLACEHOLDER"})))))),l&&r.a.createElement(B.a,null,r.a.createElement(Y.a,{alignWith:"input",htmlFor:"src_mac_address",label:r.a.createElement(n.c,{id:"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_FORM_SRC_DST_FIELD_SRC_MAC_ADDRESS_LABEL"})}),r.a.createElement(K.a,{column:!0},r.a.createElement(J.Field,{full:!0,name:"src_mac_address",placeholder:"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_FORM_SRC_DST_FIELD_SRC_MAC_ADDRESS_PLACEHOLDER"}))))});var Re=()=>r.a.createElement(x.a,{padding:"none"},r.a.createElement(B.a,null,r.a.createElement(Y.a,{alignWith:"toggleSmall",htmlFor:"logging",label:r.a.createElement(n.c,{id:"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_FORM_ADVANCED_FIELD_LOGGING_LABEL"})}),r.a.createElement(K.a,null,r.a.createElement(J.Field,{name:"logging",type:"checkbox"}))),r.a.createElement(B.a,null,r.a.createElement(Y.a,{alignWith:"toggleSmall",htmlFor:"state_new",label:r.a.createElement(n.c,{id:"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_FORM_ADVANCED_FIELD_STATE_NEW_LABEL"})}),r.a.createElement(K.a,null,r.a.createElement(J.Field,{name:"state_new",type:"checkbox"}))),r.a.createElement(B.a,null,r.a.createElement(Y.a,{alignWith:"toggleSmall",htmlFor:"state_established",label:r.a.createElement(n.c,{id:"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_FORM_ADVANCED_FIELD_STATE_ESTABLISHED_LABEL"})}),r.a.createElement(K.a,null,r.a.createElement(J.Field,{name:"state_established",type:"checkbox"}))),r.a.createElement(B.a,null,r.a.createElement(Y.a,{alignWith:"toggleSmall",htmlFor:"state_invalid",label:r.a.createElement(n.c,{id:"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_FORM_ADVANCED_FIELD_STATE_INVALID_LABEL"})}),r.a.createElement(K.a,null,r.a.createElement(J.Field,{name:"state_invalid",type:"checkbox"}))),r.a.createElement(B.a,null,r.a.createElement(Y.a,{alignWith:"toggleSmall",htmlFor:"state_related",label:r.a.createElement(n.c,{id:"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_FORM_ADVANCED_FIELD_STATE_RELATED_LABEL"})}),r.a.createElement(K.a,null,r.a.createElement(J.Field,{name:"state_related",type:"checkbox"}))),r.a.createElement(B.a,null,r.a.createElement(Y.a,{alignWith:"toggleSmall",htmlFor:"ipsec",label:r.a.createElement(n.c,{id:"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_FORM_ADVANCED_FIELD_IPSEC_LABEL"})}),r.a.createElement(K.a,null,r.a.createElement(J.Field,{full:!0,name:"ipsec",options:P,translateOptions:!0,type:"dropdown"}))));var oe=()=>{const e=Object(_.useMemo)(()=>[{id:"firewall-rule-source",label:r.a.createElement(n.c,{id:"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_FORM_ACCORDION_SOURCE_LABEL"}),renderContent:()=>r.a.createElement(ce,{src:!0})},{id:"firewall-rule-destination",label:r.a.createElement(n.c,{id:"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_FORM_ACCORDION_DESTINATION_LABEL"}),renderContent:()=>r.a.createElement(ce,{dst:!0})},{id:"firewall-rule-advanced",label:r.a.createElement(n.c,{id:"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_FORM_ACCORDION_ADVANCED_LABEL"}),renderContent:()=>r.a.createElement(Re,null)}],[]);return Object(m.e)([Object(o.fetchFirewallGroups)(void 0,{crudCacheStrategy:{type:k.a.CACHE}}),Object(i.fetchFirewallRules)(void 0,{crudCacheStrategy:{type:k.a.CACHE}}),Object(N.fetchNetworks)(void 0,{crudCacheStrategy:{type:k.a.CACHE}}),Object(H.fetchSiteGateway)()],r.a.createElement(r.a.Fragment,null,r.a.createElement(z,null),r.a.createElement(v.a,{items:e,multiOpen:!0})))};l.default=()=>{const e=Object(m.g)(),{ruleId:l}=Object(c.m)(),t=Object(T.useDispatch)(),d=Object(T.useSelector)(i.selectAllFirewallRules),I=Object(T.useSelector)(N.selectCorporateAndGuestNetworks),O=Object(T.useSelector)(o.selectFirewallGroups),F=Object(T.useSelector)(i.selectFirewallRule)(l),G=Object(T.useSelector)(A.u),D=Object(T.useSelector)(u.k),b=Object(_.useMemo)(()=>w(I,O,F),[I,O,F]),U=Object(m.m)({component:r.a.createElement(n.c,{id:"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_FORM_TITLE_NEW"}),message:"firewall-rule"},"firewall-rule",(null==F?void 0:F._id)?null==F?void 0:F.name:void 0),f=Object(_.useCallback)((l,{setSubmitting:_})=>t(Object(i.saveFirewallRule)(((e,l,t,_)=>{const r=w([],[]),{firewallRuleApplied:n,firewallRuleDstIpV4AddressGroup:T,firewallRuleDstIpV6AddressGroup:c,firewallRuleDstPortGroup:R,firewallRuleDstType:o,firewallRuleProtocolNumber:N,firewallRuleSrcIpV4AddressGroup:A,firewallRuleSrcIpV6AddressGroup:u,firewallRuleSrcPortGroup:s,firewallRuleSrcType:L,...S}=e;S.dst_firewallgroup_ids=o===a.ADDRESS_PORT_GROUP?[].concat((M(e)?c:T)||[]).concat(R||[]):r.dst_firewallgroup_ids,S.src_firewallgroup_ids=L===a.ADDRESS_PORT_GROUP?[].concat((M(e)?u:A)||[]).concat(s||[]):r.src_firewallgroup_ids,M(e)?(delete S.dst_address,delete S.dst_networkconf_id,delete S.dst_networkconf_type,delete S.dst_port,delete S.icmp_typename,delete S.protocol,delete S.src_address,delete S.src_networkconf_id,delete S.src_networkconf_type,delete S.src_port,S.icmpv6_typename="icmpv6"!==e.protocol_v6||e.protocol_match_excepted?r.icmpv6_typename:e.icmpv6_typename,S.protocol_match_excepted="all"===e.protocol_v6?r.protocol_match_excepted:e.protocol_match_excepted,S.protocol_v6="number"===e.protocol_v6?Number(e.firewallRuleProtocolNumber):e.protocol_v6):(delete S.icmpv6_typename,delete S.protocol_v6,S.dst_address=o===a.IP_ADDRESS?e.dst_address:r.dst_address,S.dst_networkconf_id=o===a.NETWORK?e.dst_networkconf_id:r.dst_networkconf_id,S.dst_networkconf_type=o===a.NETWORK?e.dst_networkconf_type:r.dst_networkconf_type,S.dst_port=o===a.IP_ADDRESS?e.dst_port:r.dst_port,S.icmp_typename="icmp"!==e.protocol||e.protocol_match_excepted?r.icmp_typename:e.icmp_typename,S.protocol="number"===e.protocol?Number(e.firewallRuleProtocolNumber):e.protocol,S.protocol_match_excepted="all"===e.protocol?r.protocol_match_excepted:e.protocol_match_excepted,S.src_address=L===a.IP_ADDRESS?e.src_address:r.src_address,S.src_networkconf_id=L===a.NETWORK?e.src_networkconf_id:r.src_networkconf_id,S.src_networkconf_type=L===a.NETWORK?e.src_networkconf_type:r.src_networkconf_type,S.src_port=L===a.IP_ADDRESS&&["tcp","tcp_udp","udp"].includes(e.protocol)?e.src_port:r.src_port);const m=n===E.BEFORE?i.FirewallRulePriority.HIGH:i.FirewallRulePriority.LOW;let p=e.rule_index;if(!e._id||e.ruleset!==l.ruleset||Object(i.getRulePriority)(e)!==m){const l=t?"udm":"ugw",E=M(e)?"v6":"v4",[a,r]=i.FIREWALL_RULE_INDEX_SCOPE[l][E][m],n=_.filter(({rule_index:l,ruleset:t})=>t===e.ruleset&&Number(l)>=a&&Number(l)<=r).pop()||{rule_index:a-1};p=Number(n.rule_index)+1,p=String(Math.min(p,r))}return S.rule_index=p,S})(l,b,D,d))).then(()=>{t(Object(S.c)({icon:p.a.success,message:"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_FORM_TOAST_SAVE_SUCCESS",values:{name:l.name}})),e()}).catch(e=>{t(Object(S.c)({errorMessage:e.msg,errorValues:e,icon:p.a.danger,message:"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_FORM_TOAST_SAVE_FAILURE",values:{name:l.name}})),_(!1)}),[d,t,b,D,e]),P=Object(_.useCallback)(()=>t(Object(L.b)({name:b.name,onConfirm:()=>t(Object(i.removeFirewallRule)({id:b._id,name:b.name})).then(()=>{e()})})),[t,b,e]);return r.a.createElement(s.b,{goBack:e,initialValues:b,isView:G,showBack:!0,title:U,validationSchema:y,onEscClicked:e,onSubmit:f,footerActiveOverride:!!(null==b?void 0:b._id),customFooterButtons:e=>(null==b?void 0:b._id)&&r.a.createElement(R.a,{disabled:e,type:"button",variant:"default",onClick:P},r.a.createElement(n.c,{id:"COMMON_ACTION_REMOVE"}))},r.a.createElement(oe,null))}},1954:function(e,l,t){"use strict";var E=t(0),a=t.n(E),_=t(1848),r=t(5);const n=(e,l)=>r.a`
  &-appear,
  &-enter {
    opacity: 0;
    display: flex !important;
    transform: translateY(-10px);
  }
  &-appear-active,
  &-enter-active {
    display: flex !important;
    ${e&&`flex-direction: ${e};`}
    ${l&&`padding: ${l};`}
    opacity: 1;
    transform: translateY(0px);
    transition: opacity 150ms ease-in-out, transform 300ms cubic-bezier(0.25, 0.1, 0.25, 1);
  }
  &-appear-done,
  &-enter-done {
    display: flex !important;
    ${e&&`flex-direction: ${e};`}
    ${l&&`padding: ${l};`}
    opacity: 1;
  }
  &-exit {
    display: flex !important;
    opacity: 0;
    height: 0;
    box-sizing: border-box;
    margin: 10px 0 0 !important;
    & > * {
      display: none;
    }
  }
  &-exit-active {
    display: flex !important;
    margin: 0 !important;
    transition: margin 300ms cubic-bezier(0.25, 0.1, 0.25, 1);
  }
  &-exit-done {
    display: none;
  }
`;l.a=a.a.memo(({timeout:e=300,in:l=!1,flexDirection:t,padding:r="0 0 32px",wrap:T=!1,children:c,...R})=>{const o=Object(E.useMemo)(()=>a.a.Children.map(c,(E,r)=>a.a.createElement(_.a,Object.assign({appear:l,in:l,timeout:e,classNames:n(t,void 0),mountOnEnter:!0},R),null===E?a.a.createElement("div",null):E)),[c,t,l,R,e]);return T?a.a.createElement(_.a,Object.assign({appear:l,in:l,timeout:e,classNames:n(t,r),mountOnEnter:!0},R),a.a.createElement("div",null,c)):a.a.createElement(a.a.Fragment,null,o)})},2158:function(e,l,t){"use strict";t.d(l,"e",(function(){return T})),t.d(l,"a",(function(){return c})),t.d(l,"b",(function(){return R})),t.d(l,"c",(function(){return o})),t.d(l,"d",(function(){return i})),t.d(l,"f",(function(){return N})),t.d(l,"g",(function(){return A}));var E=t(0),a=t.n(E),_=t(4),r=t(392),n=t(268);const T=e=>"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_PROTOCOL_"+e.replace(/[.-]/g,"_").toUpperCase(),c=e=>{const l=void 0!==e.protocol&&null!==e.protocol?e.protocol:e.protocol_v6,t=!Number.isNaN(Number(l));return e.protocol_match_excepted?a.a.createElement(_.c,{id:"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_TABLE_PROTOCOL_MATCH_EXCEPTED",values:{protocol:t?l:a.a.createElement(_.c,{id:T(l)})}}):t?String(l):a.a.createElement(_.c,{id:T(l)})},R=e=>{switch(e){case r.FirewallGroupType.ADDRESS_GROUP:return"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_GROUPS_TYPE_ADDRESS_GROUP";case r.FirewallGroupType.IPV6_ADDRESS_GROUP:return"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_GROUPS_TYPE_IPV6_ADDRESS_GROUP";case r.FirewallGroupType.PORT_GROUP:return"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_GROUPS_TYPE_PORT_GROUP";default:return"COMMON_UNKNOWN"}},o=e=>{switch(e){case n.FirewallRuleAction.ACCEPT:return"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_ACTION_ACCEPT";case n.FirewallRuleAction.DROP:return"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_ACTION_DROP";case n.FirewallRuleAction.REJECT:return"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_ACTION_REJECT";default:return"COMMON_UNKNOWN"}},i=e=>"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_ICMP_TYPENAME_"+(e||"none").replace(/-/g,"_").toUpperCase(),N=e=>{switch(e){case n.FirewallRuleRulesetV4.GUEST_IN:return"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_RULESET_GUEST_IN";case n.FirewallRuleRulesetV4.GUEST_LOCAL:return"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_RULESET_GUEST_LOCAL";case n.FirewallRuleRulesetV4.GUEST_OUT:return"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_RULESET_GUEST_OUT";case n.FirewallRuleRulesetV4.LAN_IN:return"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_RULESET_LAN_IN";case n.FirewallRuleRulesetV4.LAN_LOCAL:return"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_RULESET_LAN_LOCAL";case n.FirewallRuleRulesetV4.LAN_OUT:return"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_RULESET_LAN_OUT";case n.FirewallRuleRulesetV4.WAN_IN:return"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_RULESET_WAN_IN";case n.FirewallRuleRulesetV4.WAN_LOCAL:return"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_RULESET_WAN_LOCAL";case n.FirewallRuleRulesetV4.WAN_OUT:return"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_RULESET_WAN_OUT";case n.FirewallRuleRulesetV6.GUESTV6_IN:return"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_RULESET_GUESTV6_IN";case n.FirewallRuleRulesetV6.GUESTV6_LOCAL:return"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_RULESET_GUESTV6_LOCAL";case n.FirewallRuleRulesetV6.GUESTV6_OUT:return"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_RULESET_GUESTV6_OUT";case n.FirewallRuleRulesetV6.LANV6_IN:return"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_RULESET_LANV6_IN";case n.FirewallRuleRulesetV6.LANV6_LOCAL:return"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_RULESET_LANV6_LOCAL";case n.FirewallRuleRulesetV6.LANV6_OUT:return"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_RULESET_LANV6_OUT";case n.FirewallRuleRulesetV6.WANV6_IN:return"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_RULESET_WANV6_IN";case n.FirewallRuleRulesetV6.WANV6_LOCAL:return"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_RULESET_WANV6_LOCAL";case n.FirewallRuleRulesetV6.WANV6_OUT:return"SETTINGS_INTERNET_THREAT_MANAGEMENT_FIREWALL_RULES_RULESET_WANV6_OUT";default:return"COMMON_UNKNOWN"}},A=e=>{let l=Math.min(...e.map(({rule_index:e})=>Number(e)));return e.map(e=>({...e,rule_index:(l++).toString()}))}}}]);